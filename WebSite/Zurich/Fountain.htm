
<!DOCTYPE html>
<html>
<head>
    <title>You gotta find them all !</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <link href="css/smoothness/jquery-ui-1.10.3.custom.css" rel="stylesheet">
    <script src="SCRIPTS/jquery-1.9.1.js"></script>
    <script src="SCRIPTS/jquery-ui-1.10.3.custom.js"></script>

    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/catExposure.css" />

    <script src="SCRIPTS/leaflet.js"></script>
    <script type="text/javascript" src="SCRIPTS/WorldExpo1.js"></script>

    <script src="SCRIPTS/leaflet_numbered_markers.js"></script>
    <script src="SCRIPTS/Portfolio2.js"></script>
    <script src="SCRIPTS/m3Wind.js"></script>
    <script src="SCRIPTS/m3Flood.js"></script>
    <script src="SCRIPTS/point.js"></script>
    <script src="SCRIPTS/event.js"></script>

    <script src="SCRIPTS/GeoSearch/l.control.geosearch.js"></script>
    <script src="SCRIPTS/GeoSearch/l.geosearch.provider.openstreetmap.js"></script>

    <link rel="stylesheet" href="css/MarkerCluster.css" />
    <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="../dist/MarkerCluster.Default.ie.css" /><![endif]-->

    <link rel="stylesheet" href="css/leaflet.draw.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="css/leaflet.draw.ie.css" /><![endif]-->
    <script src="SCRIPTS/Draw/Leaflet.draw.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/Edit.Poly.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/Edit.SimpleShape.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/Edit.Circle.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/Edit.Rectangle.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Feature.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Polyline.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Polygon.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.SimpleShape.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Rectangle.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Circle.js"></script>
    <script src="SCRIPTS/Draw/draw/handler/Draw.Marker.js"></script>
    <script src="SCRIPTS/Draw/ext/LatLngUtil.js"></script>
    <script src="SCRIPTS/Draw/ext/GeometryUtil.js"></script>
    <script src="SCRIPTS/Draw/ext/LineUtil.Intersect.js"></script>
    <script src="SCRIPTS/Draw/ext/Polyline.Intersect.js"></script>
    <script src="SCRIPTS/Draw/ext/Polygon.Intersect.js"></script>
    <script src="SCRIPTS/Draw/Control.Draw.js"></script>
    <script src="SCRIPTS/Draw/Tooltip.js"></script>
    <script src="SCRIPTS/Draw/Toolbar.js"></script>
    <script src="SCRIPTS/Draw/draw/DrawToolbar.js"></script>
    <script src="SCRIPTS/Draw/edit/EditToolbar.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/EditToolbar.Edit.js"></script>
    <script src="SCRIPTS/Draw/edit/handler/EditToolbar.Delete.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
    <script src="SCRIPTS/google.js"></script>
    <script type="text/javascript" src="../Scripts/jquery.signalR-2.0.3.min.js"></script>
    <script type="text/javascript" src="../../signalr/hubs"></script>
    <script src="Fountain.js"></script>


    <script src="../Scripts/bPopUp.js"></script>
</head>
<body>
    <div id="newFountainDiv">
        <span class="button b-close"><span>X</span></span>
        <table style="margin-left: 50px">
            <tbody>
                <tr>
                    <td>
                        <div class="btn-group" role="group" style="margin-left: 37px;">
                            <input id="Antoine" type="checkbox" name="action" value="buy">Antoine
                            <input id="Camille" type="checkbox" name="action" value="buy">Camille
                            <input id="Loic" type="checkbox" name="action" value="buy">Loic
                            <input id="Xavier" type="checkbox" name="action" value="buy">Xavier
                            <br />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
						<input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input style="margin-left: -50px; margin-top: 30px" type="button" id="SaveFountain" class="btn btn-primary" value="Save Fountain" />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="map"></div>
    <div id="Menu">
        <ul>
            <li><a href="#Summary">Summary</a></li>
            <li><a href="#Details">Details</a></li>
        </ul>
        <div id="Summary">
            <div id="PoliceSummaryAccordion">
                <ul>
                    <li><a href="#PoliceSummary">Foutain</a></li>
                </ul>
                <div id="PoliceSummary">
                    <table>
                        <tr>
                            <td><b>Colloc</b></td>
                            <td><b>First Found</b></td>
                            <td><b>Found</b></td>
                        </tr>
                        <tr>
                            <td>Antoine</td>
                            <td id="firstAntoine">-</td>
                            <td id="foundAntoine">-</td>
                        </tr>
                        <tr>
                            <td>Camille</td>
                            <td id="firstCamille">-</td>
                            <td id="foundCamille">-</td>
                        </tr>
                        <tr>
                            <td>Loic</td>
                            <td id="firstLoic">-</td>
                            <td id="foundLoic">-</td>
                        </tr>
                        <tr>
                            <td>Xavier</td>
                            <td id="firstXavier">-</td>
                            <td id="foundXavier">-</td>
                        </tr>
                        <tr>
                            <td>Total</td>
                            <td id="firstTotal">-</td>
                            <td id="foundTotal">-</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div id="Details">
            <p> Select a fountain to get details on it</p>
        </div>
    </div>
    <script type="text/javascript">
        init();
        var menu = L.control({ position: 'bottomleft' });
        menu.onAdd = function (map) {
            this._div = document.getElementById('Menu');
            return this._div;
        };

        // control that shows state info on hover
        var info = L.control({ position: 'bottomleft' });
        //var infoEQ = L.control({position: 'topleft'});

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };

        //function to trunc a number
        truncBn0 = function (x) {
            //return Math.round(x/1000000000*10)/10
            return Math.round(x / 1000000000);
        };

        truncBn1 = function (x) {
            return Math.round(x / 1000000000 * 10) / 10
        };

        truncMn1 = function (x) {
            //return Math.round(x/1000000*10)/10
            return Math.round(x / 1000000);
        };

        prettyExpo = function (x) {
            return ((x > 1000000000) ? truncBn0(x) + ' bn€' : (x > 100000000) ? truncBn1(x) + ' bn€' : '<0.1 bn€');
        };
        function highlightFeature(e) {
            //layer is the object that fired the event (May be a multypolygon in that case)
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                //Grey color of the line
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            if (!L.Browser.ie && !L.Browser.opera) {
                layer.bringToFront();
            }

            info.update(layer.feature.properties);
        }

        var geojson;

        function resetHighlight(e) {
            var layer = e.target;
            layer.setStyle({
                weight: 2,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            });
            //With the resetStyle function there were problems
            //It was not taking into account the modification made to the fill color
            //geojson.resetStyle(e.target);
            info.update();
        }


        function zoomToFeature(e) {
            var layer = e.target;
            map.fitBounds(e.target.getBounds());
            //Update the information on click for Iphone/Ipad
            info.update(layer.feature.properties);
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }

        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
				grades = [0, 100000000, 500000000, 1000000000, 2000000000, 10000000000, 40000000000, 200000000000, 500000000000],
				labels = [],
				from, to;

            for (var i = 0; i < grades.length; i++) {
                from = grades[i];
                to = grades[i + 1];

                labels.push(
					'<i style="background:' + getColor(from + 1) + '"></i> ' +
					truncBn1(from) + (to ? '&ndash;' + truncBn1(to) + ' bn€' : '+ bn€'));
            }

            div.innerHTML = labels.join('<br>');
            return div;
        };


        function updatePosition(pos) {
            map = new L.Map('map', { center: new L.LatLng(pos.coords.latitude, pos.coords.longitude), zoom: 15 });
            createMap();
        }

        function positionError(pos) {
            map = new L.Map('map', { center: new L.LatLng(51.51, -0.11), zoom: 15 });
            createMap();
        }

        navigator.geolocation.getCurrentPosition(updatePosition, positionError);

        function createMap() {
            var googleLayer = new L.Google('ROADMAP');
            map.addLayer(googleLayer);

            map.on('overlayremove', function(eventLayer) {
                this.removeControl(legend);
                this.removeControl(info);

            });

            map.on('overlayadd', function(eventLayer) {
                legend.addTo(this);
                info.addTo(this);
            });

            map.on('geosearch_showlocation', function(result) {
                map.setZoom(16);
            });

            menu.addTo(map);

            new L.Control.GeoSearch({
                provider: new L.GeoSearch.Provider.OpenStreetMap(),
                showMarker: false
            }).addTo(map);
            var drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            var drawControl = new L.Control.Draw({
                float: 'bottomleft',
                draw: {
                    polyline: false,
                    rectangle: false,
                    polygon: false,
                    circle: false,
                    marker: {
                        shapeOptions: {
                            color: '#662d91'
                        }
                    },
                    custom: {
                        shapeOptions: {
                            color: '#662d91'
                        }
                    }
                },
                edit: false
            });
            map.addControl(drawControl);

            map.on('draw:created', function(e) {
                drawnItems.addLayer(e.layer);
                fontainPosLat = e.layer._latlng.lat;
                fontainPosLng = e.layer._latlng.lng;
                $("#newFountainDiv").bPopup({
                    onOpen: function() {
                    },
                    follow: [false, false],
                    speed: 250,
                    transition: 'slideIn',
                    transitionClose: 'slideBack'
                });
            });
        }
    </script>
</body>
</html>
